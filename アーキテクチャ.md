# Discord Bot 「ミスカトニック大学 Bot」アーキテクチャ

## リポジトリ

```md
- discordbot.py
  - 本体。Bot を起動させたい場合はこれ。
- parseMessage.py
  - マルチをカレンダー登録する際のメッセージパース用
- registerGoogleCalender.py
  - マルチをカレンダー登録する処理。
- example.py
  - マルチをカレンダー登録する処理の動作確認用。
  - example.txt から内容を読み取ってカレンダーに登録する。
```

## 非リポジトリ管理

1. ボットトークン
   - `discord_token`
1. サービスアカウント情報
   - `svc.json`
1. カレンダー ID
   - `calendar_id`

### 1. ボットトークン

ミナトからトークンファイルを譲渡する。

### 2. サービスアカウント

1. Google Cloud Platform トップから新規プロジェクトを作成する。
   (動作させる際の Computing Engine もこのプロジェクト下に建てるといい)
2. トップバー左のハンバーガーメニューから「IAM」 -> 「サービスアカウント」を選択
3. 画面上部「サービスアカウントの作成」を選択
4. 必要事項を記入する
5. 権限の付与はスキップで OK
6. ステップ 3「キーの作成」で JSON ファイルを作成・ダウンロード

(ここで作ったサービスアカウント ID は 3. で使うのでメモしておく)

### 3. カレンダー ID

(現行のカレンダーを引き続き使う場合、2. のサービスアカウント ID を共有してください)

1. Google カレンダー で共有用カレンダーを作成
2. 右上の歯車マークから設定ページを開く
3. 作成した共有用カレンダーの設定を開く
4. 下にスクロールし、共有するユーザーの設定で予めメモしておいたサービスアカウント ID を共有先に指定する
5. さらに下にスクロールし、カレンダー ID をメモ
6. `calendar_id`として保存
